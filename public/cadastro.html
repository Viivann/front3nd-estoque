<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Cadastro - Sistema de Estoque</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="page-geral">
  <h1 class="page-title">Cadastro</h1>

  <!-- container SEM active -->
  <div class="container">

    <!-- FORM CADASTRO -->
    <div class="form-box Login">  
      <h2 class="animation" style="--D:1;">Criar conta</h2>

      <div class="input-box animation" style="--D:2;">
        <input type="text" id="nome" required>
        <label>Nome de usuário</label>
      </div>

      <div class="input-box animation" style="--D:3;">
        <input type="password" id="senha" required>
        <label>Senha</label>
      </div>

      <div class="input-box animation" style="--D:4;">
        <input type="password" id="senha2" required>
        <label>Confirmar senha</label>
      </div></br>

      <button class="btn animation" style="--D:5;" onclick="cadastrar()">
        Cadastrar
      </button>

      <p id="msg" class="animation" style="--D:6;"></p>

      <p class="regi-link animation" style="--D:7;">
        Já tem conta? <a href="login.html">Fazer login</a>
      </p>
    </div>

    <!-- LADO INFORMACIONAL -->
    <div class="info-content Login">
      <h2 class="animation" style="--S:1;">Bem-vindo!</h2>
      <p class="animation" style="--S:2;">
        Crie sua conta para acessar o sistema de estoque.
      </p>
    </div>

    <div class="curved-shape"></div>
    <div class="curved-shape2"></div>

  </div>
</div>

<script>
async function cadastrar() {
  const nome   = document.getElementById('nome').value;
  const senha  = document.getElementById('senha').value;
  const senha2 = document.getElementById('senha2').value;
  const msg    = document.getElementById('msg');

  msg.textContent = '';

  if (!nome || !senha || !senha2) {
    msg.textContent = "Preencha todos os campos.";
    msg.style.color = "red";
    return;
  }

  if (senha !== senha2) {
    msg.textContent = "As senhas não conferem.";
    msg.style.color = "red";
    return;
  }

  try {
    const resp = await fetch('https://backend-estoque-ik2m.onrender.com/usuarios', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ nome, senha })
    });

    const data = await resp.json();

    if (!resp.ok) {
      msg.textContent = data.error || "Erro ao cadastrar.";
      msg.style.color = "red";
      return;
    }

    msg.textContent = "Usuário cadastrado com sucesso!";
    msg.style.color = "lightgreen";

    setTimeout(() => {
      window.location.href = "login.html";
    }, 1500);

  } catch (e) {
    msg.textContent = "Erro ao conectar com o servidor.";
    msg.style.color = "red";
  }
}
</script>

</body>
</html>
